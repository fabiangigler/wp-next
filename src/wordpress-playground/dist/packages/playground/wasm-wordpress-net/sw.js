function m(e){return e.pathname.startsWith("/scope:")}function w(e){return m(e)?e.pathname.split("/")[1].split(":")[1]:null}function M(e,t){let r=new URL(e);if(m(r))if(t){const s=r.pathname.split("/");s[1]=`scope:${t}`,r.pathname=s.join("/")}else r=R(r);else if(t){const s=r.pathname==="/"?"":r.pathname;r.pathname=`/scope:${t}${s}`}return r}function R(e){if(!m(e))return e;const t=new URL(e),r=t.pathname.split("/");return t.pathname="/"+r.slice(2).join("/"),t}const U=function(){return typeof process<"u"&&process.release?.name==="node"?"NODE":typeof window<"u"?"WEB":typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?"WORKER":"NODE"}();if(U==="NODE"){let e=function(r){return new Promise(function(s,o){r.onload=r.onerror=function(n){r.onload=r.onerror=null,n.type==="load"?s(r.result):o(new Error("Failed to read the blob/file"))}})},t=function(){const r=new Uint8Array([1,2,3,4]),o=new File([r],"test").stream();try{return o.getReader({mode:"byob"}),!0}catch{return!1}};if(typeof File>"u"){class r extends Blob{constructor(o,n,i){super(o);let a;i?.lastModified&&(a=new Date),(!a||isNaN(a.getFullYear()))&&(a=new Date),this.lastModifiedDate=a,this.lastModified=a.getMilliseconds(),this.name=n||""}}global.File=r}typeof Blob.prototype.arrayBuffer>"u"&&(Blob.prototype.arrayBuffer=function(){const s=new FileReader;return s.readAsArrayBuffer(this),e(s)}),typeof Blob.prototype.text>"u"&&(Blob.prototype.text=function(){const s=new FileReader;return s.readAsText(this),e(s)}),(typeof Blob.prototype.stream>"u"||!t())&&(Blob.prototype.stream=function(){let r=0;const s=this;return new ReadableStream({type:"bytes",autoAllocateChunkSize:512*1024,async pull(o){const n=o.byobRequest.view,a=await s.slice(r,r+n.byteLength).arrayBuffer(),u=new Uint8Array(a);new Uint8Array(n.buffer).set(u);const c=u.byteLength;o.byobRequest.respond(c),r+=c,r>=s.size&&o.close()}})})}if(U==="NODE"&&typeof CustomEvent>"u"){class e extends Event{constructor(r,s={}){super(r,s),this.detail=s.detail}initCustomEvent(){}}globalThis.CustomEvent=e}const g={0:"No error occurred. System call completed successfully.",1:"Argument list too long.",2:"Permission denied.",3:"Address in use.",4:"Address not available.",5:"Address family not supported.",6:"Resource unavailable, or operation would block.",7:"Connection already in progress.",8:"Bad file descriptor.",9:"Bad message.",10:"Device or resource busy.",11:"Operation canceled.",12:"No child processes.",13:"Connection aborted.",14:"Connection refused.",15:"Connection reset.",16:"Resource deadlock would occur.",17:"Destination address required.",18:"Mathematics argument out of domain of function.",19:"Reserved.",20:"File exists.",21:"Bad address.",22:"File too large.",23:"Host is unreachable.",24:"Identifier removed.",25:"Illegal byte sequence.",26:"Operation in progress.",27:"Interrupted function.",28:"Invalid argument.",29:"I/O error.",30:"Socket is connected.",31:"There is a directory under that path.",32:"Too many levels of symbolic links.",33:"File descriptor value too large.",34:"Too many links.",35:"Message too large.",36:"Reserved.",37:"Filename too long.",38:"Network is down.",39:"Connection aborted by network.",40:"Network unreachable.",41:"Too many files open in system.",42:"No buffer space available.",43:"No such device.",44:"There is no such file or directory OR the parent directory does not exist.",45:"Executable file format error.",46:"No locks available.",47:"Reserved.",48:"Not enough space.",49:"No message of the desired type.",50:"Protocol not available.",51:"No space left on device.",52:"Function not supported.",53:"The socket is not connected.",54:"Not a directory or a symbolic link to a directory.",55:"Directory not empty.",56:"State not recoverable.",57:"Not a socket.",58:"Not supported, or operation not supported on socket.",59:"Inappropriate I/O control operation.",60:"No such device or address.",61:"Value too large to be stored in data type.",62:"Previous owner died.",63:"Operation not permitted.",64:"Broken pipe.",65:"Protocol error.",66:"Protocol not supported.",67:"Protocol wrong type for socket.",68:"Result too large.",69:"Read-only file system.",70:"Invalid seek.",71:"No such process.",72:"Reserved.",73:"Connection timed out.",74:"Text file busy.",75:"Cross-device link.",76:"Extension: Capabilities insufficient."};function O(e){const t=typeof e=="object"?e?.errno:null;if(t in g)return g[t]}function d(e=""){return function(r,s,o){const n=o.value;o.value=function(...i){try{return n.apply(this,i)}catch(a){const u=typeof a=="object"?a?.errno:null;if(u in g){const c=g[u],h=typeof i[1]=="string"?i[1]:null,y=h!==null?e.replaceAll("{path}",h):e;throw new Error(`${y}: ${c}`,{cause:a})}throw a}}}}const S="playground-log",x=(e,...t)=>{L.dispatchEvent(new CustomEvent(S,{detail:{log:e,args:t}}))},q=(e,...t)=>{switch(typeof e.message=="string"?e.message=E(e.message):e.message.message&&typeof e.message.message=="string"&&(e.message.message=E(e.message.message)),e.severity){case"Debug":console.debug(e.message,...t);break;case"Info":console.info(e.message,...t);break;case"Warn":console.warn(e.message,...t);break;case"Error":console.error(e.message,...t);break;case"Fatal":console.error(e.message,...t);break;default:console.log(e.message,...t)}},P=e=>e instanceof Error?[e.message,e.stack].join(`
`):JSON.stringify(e,null,2),D=[],k=e=>{D.push(e)},v=e=>{if(e.raw===!0)k(e.message);else{const t=j(typeof e.message=="object"?P(e.message):e.message,e.severity??"Info",e.prefix??"JavaScript");k(t)}};class $ extends EventTarget{constructor(t=[]){super(),this.handlers=t,this.fatalErrorEvent="playground-fatal-error"}getLogs(){return this.handlers.includes(v)?[...D]:(this.error(`Logs aren't stored because the logToMemory handler isn't registered.
				If you're using a custom logger instance, make sure to register logToMemory handler.
			`),[])}logMessage(t,...r){for(const s of this.handlers)s(t,...r)}log(t,...r){this.logMessage({message:t,severity:void 0,prefix:"JavaScript",raw:!1},...r)}debug(t,...r){this.logMessage({message:t,severity:"Debug",prefix:"JavaScript",raw:!1},...r)}info(t,...r){this.logMessage({message:t,severity:"Info",prefix:"JavaScript",raw:!1},...r)}warn(t,...r){this.logMessage({message:t,severity:"Warn",prefix:"JavaScript",raw:!1},...r)}error(t,...r){this.logMessage({message:t,severity:"Error",prefix:"JavaScript",raw:!1},...r)}}const F=()=>{try{if(process.env.NODE_ENV==="test")return[v,x]}catch{}return[v,q,x]},L=new $(F()),E=e=>e.replace(/\t/g,""),j=(e,t,r)=>{const s=new Date,o=new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"2-digit",timeZone:"UTC"}).format(s).replace(/ /g,"-"),n=new Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,timeZone:"UTC",timeZoneName:"short"}).format(s),i=o+" "+n;return e=E(e),`[${i}] ${r} ${t}: ${e}`},H=e=>{e.addEventListener("activate",()=>{e.clients.matchAll().then(t=>{const r={numberOfOpenPlaygroundTabs:t.filter(s=>s.frameType==="top-level").length};for(const s of t)s.postMessage(r)})})};function T(...e){let t=e.join("/");const r=t[0]==="/",s=t.substring(t.length-1)==="/";return t=C(t),!t&&!r&&(t="."),t&&s&&(t+="/"),t}function _(e){if(e==="/")return"/";e=C(e);const t=e.lastIndexOf("/");return t===-1?"":t===0?"/":e.substr(0,t)}function C(e){const t=e[0]==="/";return e=G(e.split("/").filter(r=>!!r),!t).join("/"),(t?"/":"")+e.replace(/\/$/,"")}function G(e,t){let r=0;for(let s=e.length-1;s>=0;s--){const o=e[s];o==="."?e.splice(s,1):o===".."?(e.splice(s,1),r++):r&&(e.splice(s,1),r--)}if(t)for(;r;r--)e.unshift("..");return e}var J=Object.defineProperty,z=Object.getOwnPropertyDescriptor,f=(e,t,r,s)=>{for(var o=s>1?void 0:s?z(t,r):t,n=e.length-1,i;n>=0;n--)(i=e[n])&&(o=(s?i(t,r,o):i(o))||o);return s&&o&&J(t,r,o),o};const p=class l{static readFileAsText(t,r){return new TextDecoder().decode(l.readFileAsBuffer(t,r))}static readFileAsBuffer(t,r){return t.readFile(r)}static writeFile(t,r,s){t.writeFile(r,s)}static unlink(t,r){t.unlink(r)}static mv(t,r,s){try{const o=t.lookupPath(r).node.mount,n=l.fileExists(t,s)?t.lookupPath(s).node.mount:t.lookupPath(_(s)).node.mount;o.mountpoint!==n.mountpoint?(l.copyRecursive(t,r,s),l.rmdir(t,r,{recursive:!0})):t.rename(r,s)}catch(o){const n=O(o);throw n?new Error(`Could not move ${r} to ${s}: ${n}`,{cause:o}):o}}static rmdir(t,r,s={recursive:!0}){s?.recursive&&l.listFiles(t,r).forEach(o=>{const n=`${r}/${o}`;l.isDir(t,n)?l.rmdir(t,n,s):l.unlink(t,n)}),t.rmdir(r)}static listFiles(t,r,s={prependPath:!1}){if(!l.fileExists(t,r))return[];try{const o=t.readdir(r).filter(n=>n!=="."&&n!=="..");if(s.prependPath){const n=r.replace(/\/$/,"");return o.map(i=>`${n}/${i}`)}return o}catch(o){return L.error(o,{path:r}),[]}}static isDir(t,r){return l.fileExists(t,r)?t.isDir(t.lookupPath(r).node.mode):!1}static fileExists(t,r){try{return t.lookupPath(r),!0}catch{return!1}}static mkdir(t,r){t.mkdirTree(r)}static copyRecursive(t,r,s){const o=t.lookupPath(r).node;if(t.isDir(o.mode)){t.mkdirTree(s);const n=t.readdir(r).filter(i=>i!=="."&&i!=="..");for(const i of n)l.copyRecursive(t,T(r,i),T(s,i))}else t.writeFile(s,t.readFile(r))}};f([d('Could not read "{path}"')],p,"readFileAsText",1);f([d('Could not read "{path}"')],p,"readFileAsBuffer",1);f([d('Could not write to "{path}"')],p,"writeFile",1);f([d('Could not unlink "{path}"')],p,"unlink",1);f([d('Could not remove directory "{path}"')],p,"rmdir",1);f([d('Could not list files in "{path}"')],p,"listFiles",1);f([d('Could not stat "{path}"')],p,"isDir",1);f([d('Could not stat "{path}"')],p,"fileExists",1);f([d('Could not create directory "{path}"')],p,"mkdir",1);f([d('Could not copy files from "{path}"')],p,"copyRecursive",1);(function(){return typeof process<"u"&&process.release?.name==="node"?"NODE":typeof window<"u"?"WEB":typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?"WORKER":"NODE"})();ReadableStream.prototype[Symbol.asyncIterator]||(ReadableStream.prototype[Symbol.asyncIterator]=async function*(){const e=this.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)return;yield r}}finally{e.releaseLock()}},ReadableStream.prototype.iterate=ReadableStream.prototype[Symbol.asyncIterator]);function Z(e,t){for(const r of t)if(new RegExp(r.match).test(e))return e.replace(r.match,r.replacement);return e}const K=25e3;let V=0;function X(){return++V}function A(e,t,r=K){return new Promise((s,o)=>{const n=a=>{a.data.type==="response"&&a.data.requestId===t&&(e.removeEventListener("message",n),clearTimeout(i),s(a.data.response))},i=setTimeout(()=>{o(new Error("Request timed out")),e.removeEventListener("message",n)},r);e.addEventListener("message",n)})}function Y(e){const{handleRequest:t=Q}=e;self.addEventListener("fetch",r=>{const s=new URL(r.request.url);if(s.pathname.startsWith(self.location.pathname))return;if(!m(s)){let n;try{n=new URL(r.request.referrer)}catch{return}if(!m(n))return}const o=t(r);o&&r.respondWith(o)})}async function Q(e){e.preventDefault();const t=new URL(e.request.url),r=await N(e);if(r.status===404&&r.headers.get("x-file-type")==="static"){const s=await B(e.request,{url:t,credentials:"omit"});return fetch(s)}return r}async function N(e){let t=new URL(e.request.url);if(!m(t))try{const i=new URL(e.request.referrer);t=M(t,w(i))}catch{}const r=e.request.headers.get("content-type"),s=e.request.method==="POST"?new Uint8Array(await e.request.clone().arrayBuffer()):void 0,o={};for(const i of e.request.headers.entries())o[i[0]]=i[1];let n;try{const i={method:"request",args:[{body:s,url:t.toString(),method:e.request.method,headers:{...o,Host:t.host,"User-agent":self.navigator.userAgent,"Content-type":r}}]},a=w(t);if(a===null)throw new Error(`The URL ${t.toString()} is not scoped. This should not happen.`);const u=await W(i,a);n=await A(self,u),delete n.headers["x-frame-options"]}catch(i){throw console.error(i,{url:t.toString()}),i}return new Response(n.bytes,{headers:n.headers,status:n.httpStatusCode})}async function W(e,t){const r=X();for(const s of await self.clients.matchAll({includeUncontrolled:!0}))s.postMessage({...e,scope:t,requestId:r});return r}async function B(e,t){const r=["GET","HEAD"].includes(e.method)||"body"in t?void 0:await e.blob();return new Request(t.url||e.url,{body:r,method:e.method,headers:e.headers,referrer:e.referrer,referrerPolicy:e.referrerPolicy,mode:e.mode==="navigate"?"same-origin":e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,integrity:e.integrity,...t})}const ee=[{match:/^\/(.*?)(\/wp-(content|admin|includes)\/.*)/g,replacement:"$2"}];self.document||(self.document={});H(self);Y({handleRequest(e){const t=new URL(e.request.url);let r=w(t);if(!r)try{r=w(new URL(e.request.referrer))}catch{}const s=R(t);if(s.pathname.startsWith("/plugin-proxy")||s.pathname.startsWith("/client/index.js"))return;e.preventDefault();async function n(){if(t.pathname.endsWith("/wp-includes/empty.html"))return re();const{staticAssetsDirectory:i}=await se(r),a=await N(e);if(a.status===404&&a.headers.get("x-file-type")==="static"){const u=new URL(e.request.url),c=R(u);c.pathname=Z(c.pathname,ee),!c.pathname.startsWith("/@fs")&&!c.pathname.startsWith("/assets")&&(c.pathname=`/${i}${c.pathname}`);const h=await B(e.request,{url:c,credentials:"omit"});return fetch(h).catch(y=>{if(y?.name==="TypeError")return new Promise(I=>{setTimeout(()=>{I(fetch(h))},Math.random()*1500)});throw y})}if(s.pathname.endsWith("/wp-includes/js/dist/block-editor.js")||s.pathname.endsWith("/wp-includes/js/dist/block-editor.min.js")||s.pathname.endsWith("/build/block-editor/index.js")||s.pathname.endsWith("/build/block-editor/index.min.js")){const u=await a.text(),c=`${te} ${u.replace(/\(\s*"iframe",/,"(__playground_ControlledIframe,")}`;return new Response(c,{status:a.status,statusText:a.statusText,headers:a.headers})}return a}return n()}});const te=`
window.__playground_ControlledIframe = window.wp.element.forwardRef(function (props, ref) {
	const source = window.wp.element.useMemo(function () {
		/**
		 * A synchronous function to read a blob URL as text.
		 *
		 * @param {string} url
		 * @returns {string}
		 */
		const __playground_readBlobAsText = function (url) {
			try {
			let xhr = new XMLHttpRequest();
			xhr.open('GET', url, false);
			xhr.overrideMimeType('text/plain;charset=utf-8');
			xhr.send();
			return xhr.responseText;
			} catch(e) {
			return '';
			} finally {
			URL.revokeObjectURL(url);
			}
		};
		if (props.srcDoc) {
			// WordPress <= 6.2 uses a srcDoc that only contains a doctype.
			return '/wp-includes/empty.html';
		} else if (props.src && props.src.startsWith('blob:')) {
			// WordPress 6.3 uses a blob URL with doctype and a list of static assets.
			// Let's pass the document content to empty.html and render it there.
			return '/wp-includes/empty.html#' + encodeURIComponent(__playground_readBlobAsText(props.src));
		} else {
			// WordPress >= 6.4 uses a plain HTTPS URL that needs no correction.
			return props.src;
		}
	}, [props.src]);
	return (
		window.wp.element.createElement('iframe', {
			...props,
			ref: ref,
			src: source,
			// Make sure there's no srcDoc, as it would interfere with the src.
			srcDoc: undefined
		})
	)
});`;function re(){return new Response("<!doctype html><script>const hash = window.location.hash.substring(1); if ( hash ) document.write(decodeURIComponent(hash))<\/script>",{status:200,headers:{"content-type":"text/html"}})}const b={};async function se(e){if(!b[e]){const t=await W({method:"getWordPressModuleDetails"},e);b[e]=await A(self,t)}return b[e]}
